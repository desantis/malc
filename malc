#!/bin/sh

if [ -z "$MAL" ] ; then
  MAL="ruby ../mal/ruby/stepA_mal.rb"
fi

set -e
if [ -n "$2" ] ; then
  base="$2"
else
  base="$(dirname $1)/$(basename $1 .mal)"
fi
$MAL malc.mal $1 > $base.ll
opt -S -O3 $base.ll -o $base.opt.ll
llc -filetype=obj $base.opt.ll -o $base.o
gcc $base.o -o $base
